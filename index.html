<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>HTML5 RPG â€“ Mobile Legends Style</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<style>
body{margin:0;overflow:hidden;background:#000}
#ui{
 position:fixed;top:10px;left:10px;color:white;
 background:rgba(0,0,0,.5);padding:8px;border-radius:6px;
 font-family:Arial;z-index:10
}
#joy{
 position:fixed;bottom:40px;left:40px;
 width:120px;height:120px;border-radius:50%;
 background:rgba(255,255,255,.15);touch-action:none
}
#stick{
 position:absolute;left:40px;top:40px;
 width:40px;height:40px;border-radius:50%;
 background:rgba(255,255,255,.6)
}
.btn{
 position:fixed;bottom:40px;width:70px;height:70px;
 border-radius:50%;color:white;
 display:flex;align-items:center;justify-content:center;
 font-weight:bold
}
#atk{right:40px;background:#a00}
</style>
</head>

<body>
<div id="ui"></div>
<div id="joy"><div id="stick"></div></div>
<div class="btn" id="atk">ATK</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.155/build/three.min.js"></script>

<script>
// ---------- CORE ----------
const scene=new THREE.Scene();
scene.background=new THREE.Color(0x87b37a);

const camera=new THREE.PerspectiveCamera(60,innerWidth/innerHeight,.1,300);
const renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth,innerHeight);
document.body.appendChild(renderer.domElement);

// ---------- LIGHT ----------
scene.add(new THREE.AmbientLight(0xffffff,.6));
const sun=new THREE.DirectionalLight(0xffffff,1);
sun.position.set(20,30,10);
scene.add(sun);

// ---------- GROUND ----------
const ground=new THREE.Mesh(
 new THREE.PlaneGeometry(300,300),
 new THREE.MeshStandardMaterial({color:0x355f2e})
);
ground.rotation.x=-Math.PI/2;
scene.add(ground);

// ---------- PLAYER (MODULAR HUMANOID) ----------
const player=new THREE.Group();
player.position.y=1;

const body=new THREE.Mesh(
 new THREE.CapsuleGeometry(.4,1.2),
 new THREE.MeshStandardMaterial({color:0xddddff})
);
const head=new THREE.Mesh(
 new THREE.SphereGeometry(.3),
 new THREE.MeshStandardMaterial({color:0xffddcc})
);
head.position.y=1.2;

const armL=new THREE.Mesh(new THREE.BoxGeometry(.2,.8,.2),
 new THREE.MeshStandardMaterial({color:0xccccff}));
armL.position.set(-.45,.5,0);

const armR=armL.clone();
armR.position.x=.45;

const sword=new THREE.Mesh(
 new THREE.BoxGeometry(.1,1,.2),
 new THREE.MeshStandardMaterial({color:0xcccccc,emissive:0x222222})
);
sword.position.y=-.6;
armR.add(sword);

player.add(body,head,armL,armR);
scene.add(player);

// ---------- CITY + GATE ----------
const city=new THREE.Mesh(
 new THREE.BoxGeometry(20,3,20),
 new THREE.MeshStandardMaterial({color:0x777777})
);
city.position.set(0,1,-30);
scene.add(city);

// ---------- GUARDS ----------
const guards=[];
function spawnGuard(){
 const g=new THREE.Mesh(
  new THREE.CapsuleGeometry(.3,1),
  new THREE.MeshStandardMaterial({color:0x3366ff})
 );
 g.position.set((Math.random()*4-2),1,-20);
 g.hp=100;
 scene.add(g);
 guards.push(g);
}
for(let i=0;i<3;i++)spawnGuard();

// ---------- ENEMIES ----------
const enemies=[];
function spawnEnemy(type,x,z){
 const color={wolf:0x555555,goblin:0x00aa00,orc:0x226600}[type];
 const e=new THREE.Mesh(
  new THREE.CapsuleGeometry(.4,1.1),
  new THREE.MeshStandardMaterial({color})
 );
 e.position.set(x,1,z);
 e.type=type;
 e.hp=80;
 e.detect=10;
 scene.add(e);
 enemies.push(e);
}
spawnEnemy("wolf",8,8);
spawnEnemy("goblin",-10,6);
spawnEnemy("orc",12,-5);

// ---------- INPUT ----------
let yaw=0,drag=false,lastX=0;
addEventListener("touchstart",e=>{drag=true;lastX=e.touches[0].clientX},{passive:false});
addEventListener("touchmove",e=>{
 if(!drag)return;
 yaw-=(e.touches[0].clientX-lastX)*0.005;
 lastX=e.touches[0].clientX;
},{passive:false});
addEventListener("touchend",()=>drag=false);

// ---------- JOYSTICK ----------
const joy=document.getElementById("joy");
const stick=document.getElementById("stick");
let joyVec={x:0,y:0};

joy.addEventListener("touchmove",e=>{
 e.preventDefault();
 const r=joy.getBoundingClientRect();
 const x=e.touches[0].clientX-r.left-60;
 const y=e.touches[0].clientY-r.top-60;
 const d=Math.min(40,Math.hypot(x,y));
 const a=Math.atan2(y,x);
 joyVec={x:Math.cos(a)*d/40,y:Math.sin(a)*d/40};
 stick.style.left=40+joyVec.x*40+"px";
 stick.style.top=40+joyVec.y*40+"px";
},{passive:false});

joy.addEventListener("touchend",()=>{
 joyVec={x:0,y:0};
 stick.style.left="40px";
 stick.style.top="40px";
});

// ---------- COMBAT ----------
let swing=0;
document.getElementById("atk").onclick=()=>{swing=15};

// ---------- LOOP ----------
function animate(){
 requestAnimationFrame(animate);

 // Player move
 const dir=new THREE.Vector3(Math.sin(yaw),0,Math.cos(yaw));
 player.position.add(dir.clone().multiplyScalar(joyVec.y*.12));
 player.rotation.y=yaw;

 // Sword swing
 if(swing>0){
  armR.rotation.x=-Math.sin(swing*.3);
  swing--;
 } else armR.rotation.x=0;

 // Enemies AI
 enemies.forEach(e=>{
  const d=e.position.distanceTo(player.position);
  if(d<e.detect){
   // stop at city if guards alive
   if(player.position.z>-25 || guards.length===0)
    e.position.lerp(player.position,.01);
  }
 });

 // Camera
 camera.position.set(
  player.position.x+Math.sin(yaw)*6,
  player.position.y+4,
  player.position.z+Math.cos(yaw)*6
 );
 camera.lookAt(player.position.x,1,player.position.z);

 document.getElementById("ui").innerText=
  `Enemies:${enemies.length} Guards:${guards.length}`;

 renderer.render(scene,camera);
}
animate();

addEventListener("resize",()=>{
 camera.aspect=innerWidth/innerHeight;
 camera.updateProjectionMatrix();
 renderer.setSize(innerWidth,innerHeight);
});
</script>
</body>
</html>
 
